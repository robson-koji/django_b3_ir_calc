{% extends 'base.html' %}
{% load iterate_dicts %}
{% load mathfilters %}
{% block content %}


<style media="screen">
  h3:after {
    content:"";
    /* top:80%; */
    bottom: 7px;
    left: 0;
    right: 0;

    width:97%;
    margin-left:15px;

    height:2px;
    position:absolute;
    background:#4264ab;

}
</style>



      <!-- Dashboard wrapper start -->
      <div class="dashboard-wrapper">

        <!-- Page title start -->
        <div class="page-title clearfix">
          <h2>
            History
            <small>
              <ul>
                <li>Home</li>
                <li>/</li>
                <li>Dashboard</li>
                <li>/</li>
                <li>Tables</li>
              </ul>
            </small>
          </h2>
        </div>
        <!-- Page title end -->


        {% include "stacked_1.html" %}




        {% for key, value in months.items %}
        <!-- Row start -->
        <div class="row">
          <div class="col-md-12">

          <h3>{{ value.dt|date:"F Y" }}</h3>
          </div>

          <div class="col-md-4">
            <div class="widget">
              <div class="widget-header">
                <div class="title">
                  <span class="fs1" aria-hidden="true" data-icon=""></span> Transactions
                </div>
              </div>
              <div class="widget-body">
                <table class="table table-condensed table-bordered table-hover no-margin">
                  <tbody>
                    <tr>
                      <th style="width:60%">Buy</th>
                      <td style="width:40%" class="text-right"><span class="label label-info label_cp1">{{ value.month_buy }}</span></td>
                    </tr>
                    <tr>
                      <th>Sell</th>
                      <td class="text-right"><span class="label label-warning label_cp1">{{ value.month_sell }}</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Span4 end -->

          <!-- Span4 start -->
          <div class="col-md-4">
            <div class="widget">
              <div class="widget-header">
                <div class="title">
                  <span class="fs1" aria-hidden="true" data-icon=""></span> Outcome
                </div>
              </div>
              <div class="widget-body">
                <table class="table table-condensed table-bordered table-hover no-margin">
                  <tbody>
                    <tr>
                      <th style="width:60%">Gain</th>
                      <td style="width:40%" class="text-right"><span class="label label-success label_cp1">{{ value.month_gain|floatformat:"2" }}</span></td>
                    </tr>
                    <tr>
                      <th>Loss</th>
                      <td class="text-right"><span class="label label-danger label_cp1">{{ value.month_loss|floatformat:"2" }}</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Span4 end -->

          <!-- Span4 start -->
          <div class="col-md-4">
            <div class="widget">
              <div class="widget-header">
                <div class="title">
                  <span class="fs1" aria-hidden="true" data-icon=""></span> Accumulated
                </div>
              </div>
              <div class="widget-body">
                <table class="table table-condensed table-bordered table-hover no-margin">
                  <tbody>
                    <tr>
                      <th style="width:60%">Gain</th>
                      <td style="width:40%" class="text-right"><span class="label label-success label_cp1">{{ value.cumulate_gain|floatformat:"2" }}</span></td>
                    </tr>
                    <tr>
                      <th>Loss</th>
                      <td class="text-right"><span class="label label-danger label_cp1">{{ value.cumulate_loss|floatformat:"2" }}</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Span4 end -->


          <div class="col-md-12">
            <div class="widget">
              <div class="widget-header">
                <div class="title">
                  <span class="fs1" aria-hidden="true" data-icon=""></span> Account Balance
                </div>
              </div>

                      {% with months_operations|get_item:key as operations %}
                      <table class="table table-condensed table-striped table-hover table-bordered pull-left" id="data-table_{{ value.dt|date:"F Y" }}_2">
                        <thead>
                          <tr>
                            <th></th>
                            <th colspan='6' class="text-center">Operation</th>
                            <th colspan='4' class="text-center">Position</th>
                          </tr>
                          <tr>
                            <th></th>

                            <th>Oper</th>
                            <th>Dt</th>
                            <th>Qt</th>
                            <th>Value</th>
                            <th>Price</th>
                            <th>Profit</th>
                            <th>Loss</th>

                            <th>Qt</th>
                            <th>AvgPrice</th>
                            <th>AvgPricePrev</th>
                          </tr>
                        </thead>
                        <tbody>
                        {% for stock, value in operations.items %}
                        {% for oper in value %}
                          <tr>
                              <td><a href={% url 'history_detail' stock=oper.name %}>{{oper.name}}</a></td>
                              <td>{{oper.buy_sell}}</td>
                              <td>{{oper.dt}}</td>
                              <td>{{oper.qt}}</td>
                              <td>{{oper.value}}</td>
                              <td>{{oper.unit_price}}</td>
                              <td>{{oper.profit|floatformat:"2"}}</td>
                              <td>{{oper.loss|floatformat:"2"}}</td>

                              <td>{{oper.qt_total}}</td>
                              <td>{{oper.avg_price|floatformat:"2"}}</td>
                              <td>{{oper.avg_price_prev|floatformat:"2"}}</td>
                          </tr>
                          {% endfor %}
                        {% endfor %}
                      </tbody>
                      </table>
                      {% endwith %}


            </div>
            <!-- Row end -->
          </div>
      </div>
      {% endfor %}
      <!-- Dashboard wrapper end -->
    </div>


{% endblock content %}
